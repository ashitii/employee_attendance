{% extends 'attendance/base.html' %}
{% block title %}Manage Notices{% endblock %}
{% comment %} <style>
  /* Remove forced overflow on body/content, let Bootstrap handle it */
  .table-responsive {
    display: block;
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    background: #fff;
  }
  table {
    min-width: 600px;
    width: 100%;
  }
  @media (max-width: 768px) {
    .table-responsive {
      margin-bottom: 1rem;
    }
    table {
      min-width: 400px;
      font-size: 0.95rem;
    }
    th, td {
      font-size: 0.95rem;
      min-width: 90px;
      word-break: break-word;
    }
    .btn {
      font-size: 0.95rem;
      padding: 0.4rem 0.8rem;
    }
    .d-flex.flex-column.flex-md-row.justify-content-between.align-items-start.align-items-md-center.mb-3.gap-2.p-3 {
      flex-direction: column !important;
      gap: 1rem !important;
      align-items: stretch !important;
      padding: 1rem !important;
    }
  }
  @media (max-width: 480px) {
    table {
      min-width: 320px;
      font-size: 0.92rem;
    }
    th, td {
      font-size: 0.92rem;
      min-width: 70px;
    }
    .btn {
      font-size: 0.92rem;
      padding: 0.3rem 0.6rem;
    }
    h2 {
      font-size: 1.2rem;
    }
  }
</style> {% endcomment %}

{% block content %}
<style>
  /* Ensure action buttons are always visible and wrap on mobile */
  @media (max-width: 576px) {
    td.text-nowrap {
      white-space: normal !important;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      min-width: 110px;
      align-items: flex-start;
    }
    .table-responsive {
      overflow-x: auto !important;
      overflow-y: hidden !important;
    }
    .btn.btn-sm {
      min-width: 80px;
      font-size: 0.97rem;
      padding: 0.35rem 0.7rem;
    }
  }
</style>
<div class="container-fluid my-4 p-3">
  <div class="row">
    <div class="col-12">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3 gap-2 p-3">
        <h2 class="mb-2 mb-md-0">Manage Notices</h2>
        <a href="#" id="showAddNoticeModal" class="btn btn-primary fw-semibold shadow-sm" style="background-color: #0e0e52; color: white;">+ Add Notice</a>
      </div>

      {% if notices %}
        <div class="table-responsive custom-scroll shadow" style="overflow-x: auto; overflow-y: hidden;">
      <table class="table table-striped table-bordered align-middle text-nowrap mb-0 rounded-3 overflow-hidden ">
        <thead class="table-light">
              <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Expiry Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for notice in notices %}
                <tr>
                  <td>{{ notice.title }}</td>
                  <td style="min-width: 120px;">{{ notice.description }}</td>
                  <td>{{ notice.expiry_date }}</td>
                  <td class="text-nowrap">
                    <a href="#" class="btn btn-warning btn-sm me-1 btn-edit-notice" data-id="{{ notice.id }}" data-title="{{ notice.title|escapejs }}" data-description="{{ notice.description|escapejs }}" data-expiry="{{ notice.expiry_date }}">Edit</a>
                    <a href="{% url 'delete_notice' notice.id %}" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure?')">Delete</a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <nav class="mt-3" aria-label="Notice pagination">
          <ul class="pagination justify-content-center flex-wrap">
            {% if notices.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page={{ notices.previous_page_number }}">Previous</a>
              </li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">Previous</span></li>
            {% endif %}

            {% for num in notices.paginator.page_range %}
              {% if notices.number == num %}
                <li class="page-item active"><span class="page-link">{{ num }}</span></li>
              {% else %}
                <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
              {% endif %}
            {% endfor %}

            {% if notices.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ notices.next_page_number }}">Next</a>
              </li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">Next</span></li>
            {% endif %}
          </ul>
        </nav>
      {% else %}
        <p class="text-muted">No notices found.</p>
      {% endif %}
    </div>
  </div>
</div>

{% include 'attendance/edit_notice_modal.html' %}
{% include 'attendance/add_notice_modal.html' %}
<script>
  // Fill and show the edit modal when Edit is clicked
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.btn-edit-notice').forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        const noticeId = btn.getAttribute('data-id');
        const title = btn.getAttribute('data-title');
        const description = btn.getAttribute('data-description');
        const expiry = btn.getAttribute('data-expiry');
        document.getElementById('edit-title').value = title;
        document.getElementById('edit-description').value = description;
        document.getElementById('edit-expiry-date').value = expiry;
        document.getElementById('editNoticeForm').action = `/notices/edit/${noticeId}/`;
        const modal = new bootstrap.Modal(document.getElementById('editNoticeModal'));
        modal.show();
      });
    });
  });

  // Show the add notice modal when the Add Notice button is clicked
  document.addEventListener('DOMContentLoaded', function() {
    var addBtn = document.getElementById('showAddNoticeModal');
    if (addBtn) {
      addBtn.addEventListener('click', function(e) {
        e.preventDefault();
        var modal = new bootstrap.Modal(document.getElementById('addNoticeModal'));
        modal.show();
      });
    }
  });
</script>
{% endblock %}
